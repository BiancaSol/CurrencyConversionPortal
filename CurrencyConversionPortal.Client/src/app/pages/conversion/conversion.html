<div class="conversion-container">
  <h2>Currency Conversion</h2>
  
  <form [formGroup]="conversionForm" (ngSubmit)="onConvert()" class="conversion-form">
    <div class="form-group">
      <label for="amount">Amount to Convert:</label>
      <input 
        type="number" 
        id="amount" 
        formControlName="amount" 
        placeholder="Enter amount"
        class="form-control"
        [class.is-invalid]="conversionForm.get('amount')?.invalid && conversionForm.get('amount')?.touched"
        step="0.01"
        min="0.01"
      >
      <div *ngIf="conversionForm.get('amount')?.invalid && conversionForm.get('amount')?.touched" class="invalid-feedback">
        <div *ngIf="conversionForm.get('amount')?.errors?.['required']">Amount is required</div>
        <div *ngIf="conversionForm.get('amount')?.errors?.['min']">Amount must be greater than 0</div>
      </div>
    </div>

    <div class="form-group">
      <label for="sourceCurrency">Source Currency:</label>
      <select 
        id="sourceCurrency" 
        formControlName="sourceCurrency" 
        class="form-control"
        [class.is-invalid]="conversionForm.get('sourceCurrency')?.invalid && conversionForm.get('sourceCurrency')?.touched"
        (change)="conversionResults = []; conversionContext = null"
      >
        <option value="">Select source currency</option>
        <option *ngFor="let currency of currencies" [value]="currency.code">
          {{currency.code}} - {{currency.name}}
        </option>
      </select>
      <div *ngIf="conversionForm.get('sourceCurrency')?.invalid && conversionForm.get('sourceCurrency')?.touched" class="invalid-feedback">
        Please select a source currency
      </div>
    </div>

    <button 
      type="submit" 
      class="btn"
      [class.btn-primary]="!needsNewConversion"
      [class.btn-warning]="needsNewConversion"
      [disabled]="conversionForm.invalid || loading"
    >
      <span *ngIf="loading">Converting...</span>
      <span *ngIf="!loading && needsNewConversion">Update Conversion</span>
      <span *ngIf="!loading && !needsNewConversion">Convert</span>
    </button>
  </form>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{errorMessage}}
  </div>

  <div *ngIf="conversionResults.length > 0 && conversionContext" class="results-container">
    <h3>Conversion Results</h3>
    <div *ngIf="needsNewConversion" class="alert alert-warning">
      <strong>Note:</strong> You've changed the amount or currency. Click "Convert" to see updated results.
    </div>
    <div class="results-info">
      Converting {{conversionContext.amount}} {{conversionContext.sourceCurrency}} to:
    </div>
    <div class="results-list">
      <div *ngFor="let result of conversionResults" class="result-item">
        <div class="currency-info">
          <span class="currency-code">{{result.currency.code}}</span>
          <span class="currency-name">{{result.currency.name}}</span>
        </div>
        <span class="converted-value">{{result.convertedValue | number:'1.2-4'}}</span>
      </div>
    </div>
  </div>

  <div *ngIf="loading && conversionResults.length === 0" class="loading-message">
    Loading currencies...
  </div>
</div>
